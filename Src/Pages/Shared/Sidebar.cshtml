@{ User loggedInUser = SessionUtils.GetLoggedInUser(Context.Session)!; }

@functions {
    public bool IsActivePage(string page)
    {
        var currentPath = Context.Request.Path;
        return currentPath.ToString().Contains(page, StringComparison.OrdinalIgnoreCase);
    }
}

<div class="sidebar border border-rights col-md-3 col-lg-2 p-0 bg-body-tertiary">
	<div
		class="offcanvas-md offcanvas-end bg-body-tertiary"
		tabindex="-1"
		id="sidebarMenu"
		aria-labelledby="sidebarMenuLabel"
	>
		<div class="offcanvas-header">
		    <partial name="Logo" />
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Close" />
		</div>
		<div class="offcanvas-body flex-column py-2">
			<hr class="d-md-none my-2" />
			<ul class="nav flex-column p-2">
				<li class="nav-item">
					<div class="fw-bold">
						<img
							class="rounded-circle"
							src="~/@loggedInUser.ImageUrl"
							alt="User"
							width="50"
							height="50"
						/>
						@loggedInUser.FirstName @loggedInUser.LastName
					</div>
					<hr class="my-2" />
				</li>
				@foreach (var navItem in new[] {
					new { Page = "TestResults", Icon = "house-fill", Text = "Dashboard" },
					new { Page = "Users", Icon = "people", Text = "Users" },
					new { Page = "Tests", Icon = "file-earmark-text", Text = "Tests" },
					new { Page = "UserClasses", Icon = "gender-ambiguous", Text = "Classes" },
					new { Page = "UserClubs", Icon = "building", Text = "Clubs" },
					new { Page = "UserRoles", Icon = "gear-wide-connected", Text = "Roles" },
					new { Page = "TestWeeks", Icon = "calendar3", Text = "Weeks" }
					})
					{
						<li class="nav-item">
							<a
								class="nav-link d-flex align-items-center gap-2 p-2 @(IsActivePage(navItem.Page) ? "active" : "text-dark")"
								asp-page="/@navItem.Page/Index"
							>
								<svg class="bi"><use xlink:href="#@navItem.Icon" /></svg>
								@navItem.Text
							</a>
							<hr class="my-2" />
						</li>
					}
				<li class="mt-2 nav-item">
					<form method="POST" asp-page="/Index" asp-page-handler="logout">
						<button type="submit" class="btn btn-dark d-flex align-items-center w-100 gap-2 p-2" >
							<svg class="bi"><use xlink:href="#door-closed" /></svg>
							Logout
						</button>
					</form>
				</li>
			</ul>
		</div>
	</div>
</div>